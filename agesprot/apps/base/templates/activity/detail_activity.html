{% extends 'layout/base.html' %}

{% load static %}

{% load project_filters %}

{% block content_head %}
	<script src="{% static 'js/list.min.js' %}"></script>
	<script src="{% static 'js/list.pagination.min.js' %}"></script>
{% endblock content_head %}

{% block content %}
	<div id="wrapper">
		{% include 'elements/menu_project.html' %}
		<div id="page-wrapper">
			<div class="row">
				<div class="content-head">
					<h1>
						{{ title }}
					</h1>
				</div>
			</div>
			{% for message in messages %}
				<div class="row">
					<div class="alert alert-{{ message.tags }} col-md-4 col-md-offset-4">{{ message }}</div>
				</div>
			{% endfor %}
			<div class="row">
				<div class="col-md-8">
					<div class="col-md-12 content">
						<h2>{{ object.nombre_actividad }}</h2>
						<p><i class="glyphicon glyphicon-calendar"></i> <b>Fecha entrega: </b>{{ object.fecha_entrega }}</p>
						<p>{{ object.descripcion_actividad }}</p>
					</div>
					<div class="col-md-12">
						<h1 class="text-center">
							Tareas de la actividad
							{% if request.user.pk|verify_user_activity:object.pk %}
								<a href="{% url 'add_task_activity' project.pk project.tag_url object.pk %}" class="btn btn-default open-modal" data-toggle="modal" data-target="#Modal" style="float: right;"><i class="glyphicon glyphicon-plus"></i> | Crear tarea</a>
							{% endif %}
						</h1>
						<div class="row" id="task-list">
							<div class="form-group col-md-6 col-md-offset-3">
								<input type="text" class="search form-control" placeholder="Digite el nombre de la actividad a buscar">
							</div>
							<div class="list">
							{% for task in object.tarea_set.all %}
								<div class="col-md-6" id="object-{{ task.pk }}">
									<div class="thumbnail">
										<div class="state text-center" style="background-color: {{ task.prioridad.color_prioridad }};">
											<p><b>Prioridad: </b>{{ task.prioridad.nombre_prioridad }}</p>
										</div>
										<div class="caption">
											<h3 class="name">{{ task.nombre_tarea }}</h3>
											<p>{{ task.descripcion_tarea }}</p>
											<p><i class="glyphicon glyphicon-calendar"></i> <b>Fecha entrega: </b>{{ task.fecha_entrega }}</p>
											<p><i class="glyphicon glyphicon-user"></i> <b>Creado por: </b>{{ task.usuario.profileuser.get_full_name }}</p>
											<p><i class="glyphicon glyphicon-certificate"></i> <b>Estado: </b>{{ task.estado }}</p>
											{% if task.estado.nombre_estado == 'Proceso' %}
												<a href="{% url 'detail_task' project.pk project.tag_url object.pk task.pk %}" class="btn btn-primary">Seleccionar</a>
											{% endif %}
											{% if request.user.pk|verify_admin_project:project.pk %}
												<a href="{% url 'update_task' project.pk project.tag_url object.pk task.pk %}" class="btn btn-success open-modal" data-toggle="modal" data-target="#Modal">Editar</a>
												<a href="{% url 'delete_task' project.pk project.tag_url object.pk task.pk %}" id="{{ task.pk }}" class="btn btn-danger delete">Eliminar</a>
											{% endif %}
										</div>
									</div>
								</div>
							{% empty %}
								<div class="text-center col-md-12">
									<img src="{% static 'img/oops.png' %}" alt="{null" style="width: 150px;">
									<h2>No hay registros.</h2>
									<h4>Vaya, no se encontraron registros de tareas creadas.</h4>
								</div>
								<script>$('.search').prop('readonly', true)</script>
							{% endfor %}
							</div>
							<div class="col-md-12 text-center">
								<ul class="pagination"></ul>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="col-md-12 content">
						<h3>Usuarios en la actividad</h3>
						<div class="row">
							{% for participant in object.actividad_role_set.all %}
								<div class="col-md-12" id="object-{{ participant.pk }}" style="margin-bottom: 10px;">
									<div class="col-md-3">
										<img src="{% static participant.role.user.profileuser.get_foto %}" class="img-circle" style="width: 50px;">
									</div>
									<div class="col-md-7">
										<p>
											<b>
												<small>{{ participant.role.user.profileuser.get_full_name }}</small>
											</b><br>
											<small>{{ participant.role.role }}</small>
										</p>
									</div>
									{% if request.user.pk|verify_admin_project:project.pk %}
										<div class="col-md-1">
											<a href="{% url 'delete_user_activity' project.pk project.tag_url object.pk participant.pk %}" class="btn btn-danger delete" id="{{ participant.pk }}">
												<i class="glyphicon glyphicon-remove"></i>
											</a>
										</div>
									{% endif %}
								</div>
							{% empty %}
								<p>
									<b>No hay usuarios</b>
								</p>
							{% endfor %}
							{% if request.user.pk|verify_admin_project:project.pk %}
								<div class="col-md-12 text-center">
									<a href="{% url 'add_user_activity' project.pk project.tag_url object.pk %}" class="btn btn-success open-modal" data-toggle="modal" data-target="#Modal">Agregar usuario</a>
								</div>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock content %}

{% block content_script %}
	var options = {
		valueNames: ['name'],
		page: 6,
		plugins: [
			ListPagination({})
		]
	};
	var projectList = new List('task-list', options);
{% endblock content_script %}