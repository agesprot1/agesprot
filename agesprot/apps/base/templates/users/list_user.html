{% extends 'layout/base.html' %}

{% load staticfiles %}

{% block content %}
	<div id="wrapper">
		{% include 'elements/menu_top.html' %}
		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">{{ title }} <a href="#" class="btn btn-success">Nuevo usuario</a></h1>
				</div>
			</div>
			<div class="row">
				<table class="table table-striped table-bordered table-responsive table-hover">
					<thead>
						<tr>
							<th></th>
							<th>Nombres</th>
							<th>Apellidos</th>
							<th>Correo</th>
							<th>Tipo de usuario</th>
							<th>Estado</th>
							<th>Acci√≥n</th>
						</tr>
					</thead>
					<tbody>
						{% for user in object_list %}
							<tr>
								<td class="text-center">
									<img src="{% static user.profileuser.foto %}" class="img-responsive img-rounded" style="width: 30px; display: inline-block;">
								</td>
								<td>
									{{ user.first_name }}
								</td>
								<td>
									{{ user.last_name }}
								</td>
								<td>
									{{ user.email }}
								</td>
								<td>
									{% if user.is_superuser %}
										Administrador
									{% else %}
										Normal
									{% endif %}
								</td>
								<td>
									{% if user.is_active %}
										<span class="label label-success change-state" id="user-{{ user.pk }}" state-user="false" user-data="{{ user.pk }}" style="cursor: pointer;">Activo</span>
									{% else %}
										<span class="label label-danger change-state" id="user-{{ user.pk }}" state-user="true" user-data="{{ user.pk }}" style="cursor: pointer;">Inactivo</span>
									{% endif %}
								</td>
								<td>
									<a href="#" class="btn btn-primary">Editar</a>
									<a href="#" class="btn btn-danger">Eliminar</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
				<nav>
					<ul class="pager">
						{% if page_obj.has_previous %}
							<li>
								<a href="?page={{ page_obj.previous_page_number }}" class="previous">
									<span aria-hidden="true">&larr;</span> Anterior
								</a>
							</li>
						{% endif %}
						{% if page_obj.has_next %}
							<li>
								<a href="?page={{ page_obj.next_page_number }}" class="next">
									<span aria-hidden="true">&rarr;</span> Siguiente
								</a>
							</li>
						{% endif %}
					</ul>
				</nav>
			</div>
		</div>
	</div>
{% endblock content %}

{% block content_script %}
	$('.change-state').click(function(){
		var id = $(this).attr('id');
		var user = $(this).attr('user-data');
		var state = $(this).attr('state-user');
		$.get("/users/change-state/", {user: user, state: state}, function(data){
			show_message(data.type, data.msg);
			if(data.status == '1'){
				$('#'+id).removeClass().empty().removeAttr('state-user').addClass('label label-'+data.type_label+' change-state').attr('state-user', data.state_label).text(data.text_label);
			}
		});
	});
{% endblock content_script %}